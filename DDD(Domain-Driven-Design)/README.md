# DDD (Domain-Driven-Design) 
> DDD start! 도메인 주도 설계 구현과 핵심 개념 익히기를 읽으며 정리한 내용 입니다.

## 1. 도메인 모델 시작
* 하나의 도메인은 하위의 여러 도메인으로 나눌 수 있다.
* 도메인 마다 고정된 하위 도메인이 존재하는 것은 아니다.
* 도메인을 어떻게 구성할지 여부는 상황에 따라 달라진다.
![도메인은 여러 하위 도메인으로 구성된다.](./images/domain-configuration.png)

### 도메인 모델
기본적으로 도메인 모델은 특정 도메인을 개념적으로 표현 한 것.
즉, 도메인 모델을 사용하면 여러 관계자들이 동일한 모습으로 도메인을 이해하고 도메인 지식을 공유하는데 도움이 된다.

도메인 모델 표현 방식
- 객체 기반 주문 도메인 모델링 (주요 데이터 구성을 파악하고 기능과 데이터 보여주기 적합)
- 클래스 다이어그램, 상태 다이어그램을 이용한 상태 모델링
- 이외에도 그래프 이용한 모델링 등

### 도메인 모델 패턴

#### 계층(아키텍처) 구성

|계층(Layer)|설명
|----|--------------------------------------------------------|
|사용자인터페이스(UI) 또는 표현(Presentation)|사용자의 요청을 처리하고 정보를 보여준다.|
|응용(Application|사용자가 요청한 기능을 실행 / 업무 로직을 직접 구현하지 않으며 도메인 계층을 조합해 기능을 실행 |
|도메인|시스템이 제공할 도메이느이 규칙을 구현 |
|인프라스트럭처(Infrastructure)|데이터베이스나 메세징 시스템과 같은 외부 시스템과의 연동 처리|

* 도메인 모델 패턴
    * 해당 도메인에 규칙을 구현한 코드가 도메인 계층에 위치하고, 이런 도메인 규칙을 객체 지향 기법으로 구현하는 패턴
        (서비스 계층은 단순히 엔티티에 필요한 요청을 위임하는 역할)
    * 핵심 규칙을 구현한 코드는 도메인 모델에만 위치하므로, 규칙이 바뀌거나 확장해야할 때 다른 코드에 영향을 덜 주고 변경 내역을 모델에 반영할 수 있다.
    
> cf. 트랜잭션 스크립트 패턴
> 
> 엔티티에는 비즈니스 로직이 거의 없고 서비스 계층에서 대부분 비즈니스 로직을 처리하는 것.
    
#### 도메인 모델 도출
기획서, 유스 케이스, 사용자 스토리와 같은 요구 사항과 관련좌의 대화를 통해 도메인을 이해하는 것이 첫 시작!
도메인 모델링 때 모델을 구성하는 `핵심 구성요소`, `규칙`, `기능` 을 찾아야 한다.

#### 엔티티와 밸류
도메인을 올바르게 설계하고 구현하기 위해서는 엔티티와 밸류의 차이를 명확하게 이해하고 제대로 구분하는 것이 도메인을 구현하는데 있어 중요!

##### 엔티티
식별자를 갖는다. (각 엔티티는 서로 다른 식별자를 갖는다. ex. 주문은 각 주문마다 주문번호가 다르며 `주문번호` 가 식별자가 됨)

식별자 생성은 사용 기술과 특징에 따라 다르나 흔히 아래와 같은 방식을 사용한다.
(⚠ 같은 시간에 동시에 식별자를 생성할 때 같은 식별자가 만들어지면 안된다.)

- 특정 규칙에 따라 생성
- UUID 사용
- 값을 직접 입력
- 일련번호 사용(Oracle 시퀀스나 MySQL 자동 증가 컬럼 사용)

##### 밸류
개념적으로 완전한 하나를 표현할 때 사용 (ex. 주소 = address1, address2, zipCode)

장점) 
- 코드의 의미를 더 잘 이해할 수 있도록 한다. (개념적으로 표현된 것을 사용해 의미를 파악하기 쉬움)
- 밸류 타입을 위한 기능을 추가할 수 있다. 

밸류 객체의 데이터 변경할 때 기존 데이터 변경 보다 변경한 데이터를 갖는 새로운 밸류 객체 생성 방식 선호.
`불변 객체 (데이터 변경 기능을 제공하지 않는 타입)`로 구현하게 되면 보다 안전한 코드를 작성할 수 있다.
> 불변 객체는 참조 투명성과 스레드에 안전하다.

##### 도메인 모델에 set 메서드 넣지 않기
set 메서드는 도메인의 핵심 개념이나 의도를 코드에서 사라지게 한다.
또한, 도메인 객체 생성 시 완전한 상태가 아닐 수도 있다.
도메인 객체가 불완전한 상태로 사용되는 것 방지 하려면 생성자를 통해 필요한 데이터를 모두 받아야 한다.

